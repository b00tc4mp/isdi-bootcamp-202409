<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unsocial</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Sixtyfour&display=swap');

    :root {
        --color: #444333;
        --white: #ffffff;
        --font: 'Sixtyfour';
        font-family: var(--font);
    }

    body {
        background-color: lightgrey;
        color: var(--color);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        /*altura toda la pantalla*/
        margin: 0;
    }

    section {
        background-color: var(--white);
    }

    input {
        background-color: inherit;
        /*Significa heredado */
        font-family: inherit;
    }

    a:visited {
        color: var(--color);

    }
</style>



<body>
    <h1>Unsocial</h1>
    <section class="loggin-form">
        <h2>Login</h2>
        <form>
            <label for="loginUsername">Username</label>
            <input type="text" id="loginUsername">
            <label for="loginPassword">Password</label>
            <input type="password" id="loginPassword">
            <button type="submit">Login</button>
        </form>
        <a href="#">Register</a>
    </section>

    <section>
        <h2>Register</h2>
        <form>
            <label for="name">Name</label>
            <input type="text" id="name">

            <label for="email">Email</label>
            <input type="email" id="email">

            <label for="username">Username</label>
            <input type="text" id="username">

            <label for="password">Password</label>
            <input type="password" id="password">

            <button type="submit">Register</button>
        </form>

        <a href="#">Login</a>
    </section>

    <section>
        <h2>Home</h2>

        <div id="homeSection">
            <h3 id="welcomeMessage"></h3>
        </div>

        <button type="submit">Logout</button>
    </section>
</body>

<script>
    //Declaramos un array de usuarios para los tests
    var users = [
        { name: 'Roger', email: 'roger@roger.com', username: 'roger', password: 'roger123' },
        { name: 'Lara', email: 'lara@lara.com', username: 'lara', password: 'lara123' },
    ]

    var loggedUser;

    //La primera lógica será para mostrar correctamente las vistas
    //Definición de las variables section
    var sections = document.querySelectorAll('section');

    var loginSection = sections[0];
    loginSection.style.display = '';

    var registerSection = sections[1];
    registerSection.style.display = 'none';

    var homeSection = sections[2];
    homeSection.style.display = 'none';


    //A continuación defino el identificador para los enlaces
    var anchors = document.querySelectorAll('a');
    var registerAnchor = anchors[0];
    var loginAnchor = anchors[1];


    //Aquí vienen las lógicas para cambiar las vistas
    //registerAnchor.onclick = function(event){} ** Seria lo mismo que lo de abajo
    registerAnchor.addEventListener('click', function (event) {
        event.preventDefault() //Con esto evitamos la recarga de la página por defecto

        loginSection.style.display = 'none';
        registerSection.style.display = '';
    });

    loginAnchor.addEventListener('click', function (event) {
        event.preventDefault();
        registerSection.style.display = 'none';
        loginSection.style.display = '';
    })


    //A continuación viene el tratamiento de los forms
    var forms = document.querySelectorAll('form');


    //Logica para el formulario de registro
    var registerForm = forms[1];
    registerForm.onsubmit = function (event) {
        event.preventDefault();

        var inputs = registerForm.querySelectorAll('input');

        var nameInput = inputs[0]
        var name = nameInput.value;

        var emailInput = inputs[1]
        var email = emailInput.value;

        var usernameInput = inputs[2]
        var username = usernameInput.value;

        var passwordInput = inputs[3]
        var password = passwordInput.value;

        var user = { name: name, email: email, username: username, password: password }
        console.log(user);
        users.push(user);

        registerForm.reset(); //Método para limpiar el formulario

        //Finalmente ocultamos el formulario de registro y mostramos el de login
        registerSection.style.display = 'none';
        loginSection.style.display = '';
    }


    //Lógica para el formulario de login
    var logginForm = forms[0];
    logginForm.onsubmit = function (event) {
        event.preventDefault();

        var logginInputs = logginForm.querySelectorAll('input');
        //console.log(logginInputs)

        var fUserName = logginInputs[0].value;
        var fLoginUser = fUserName;

        var pass = logginInputs[1].value;
        var loginPassword = pass;

        //Y ahora que hemos recuperado los valores del formulario de login procedemos con la lógica para validar el usuario
        //var existe = users.find

        function validateLogin(inputUsername, inputPassword) {
            // Buscamos el usuario usando find
            var user = users.find(user => user.username === inputUsername);
            console.log(user);

            // Si el usuario existe y la contraseña coincide
            if (user && user.password === inputPassword) {
                console.log('usuario validado!')
                return user;
            } else {
                console.log('Usuario o contraseña incorrectos')
                return null;
            }
        }

        var loggedUser = validateLogin(fLoginUser, loginPassword)

        if (loggedUser) {
            console.log("Entro en la zona logueada")
            logginForm.reset();
            loginSection.style.display = 'none';
            homeSection.style.display = '';
            document.getElementById('welcomeMessage').innerText = `Welcome, ${loggedUser.name}!`;
        }
    }

    //Aquí debajo va la lógica para el logout
    var buttons = document.querySelectorAll('button');
    var loggoutButton = buttons[2];

    loggoutButton.addEventListener('click', function () {
        loggedUser = null;
        homeSection.style.display = 'none';
        loginSection.style.display = '';
        console.log("el usuario ha salido del sistema")
    })

</script>

</html>